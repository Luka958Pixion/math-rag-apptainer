Bootstrap: docker
From: python:3.11

%files
  ./requirements.txt /app/requirements.txt

%post

  # apt
  apt update -y
  apt install software-properties-common -y
  apt install -y \
    build-essential \
    libbz2-dev \
    libffi-dev \
    libgdbm-dev \
    liblzma-dev \
    libncurses5-dev \
    libnss3-dev \
    libreadline-dev \
    libsqlite3-dev \
    libssl-dev \
    wget \
    zlib1g-dev \
    git

  # pip
  pip install -r /app/requirements.txt

  # Set up Hugging Face authentication
  mkdir -p /root/.cache/huggingface
  echo "TODO_API_KEY" > /root/.cache/huggingface/token

  # Log in to Hugging Face inside the container build
  huggingface-cli login --token "$(cat /root/.cache/huggingface/token)"

  # Download the model using authentication
  HF_HOME=/app/models/llama3b huggingface-cli download meta-llama/Llama-3.2-3B --repo-type model --local-dir /app/models/llama3b --token "$(cat /root/.cache/huggingface/token)"

%environment
  export TRANSFORMERS_CACHE=/app/models/llama3b
  export HF_HOME=/app/models/llama3b
  export TRANSFORMERS_OFFLINE=1
  export HUGGINGFACE_TOKEN="$(cat /root/.cache/huggingface/token)"

%runscript
  echo "Container is set up with the Llama 3B model. You can now run your Python scripts."